server default {
  listen {
    type = auth
    ipaddr = *
    port = 1812
  }

  listen {
    type = acct
    ipaddr = *
    port = 1813
  }

  authorize {
    preprocess
    chap
    mschap
    suffix
    eap

    # Politique d'autorisation principale depuis SQL
    sql

    # Notification métier Laravel (wallet/voucher/events)
    update control {
      REST-HTTP-Header += "X-FreeRadius-Section: authorize"
    }
    rest

    expiration
    logintime
    #quotalimit
    #uptimelimit
    #accessperiod

    if (reject) {
      reject
    }
  }

  authenticate {
    Auth-Type PAP {
        pap
    }
    Auth-Type CHAP {
        chap
    }
    Auth-Type MS-CHAP {
        mschap
    }
    eap
    
    # On laisse 'rest' ici SEUL s'il est utilisé comme méthode d'auth
    # Mais le bloc "update control" doit être retiré d'ici.
    rest
  }

  accounting {
    # Garder SQL pour alimenter radacct (consommation, session stop, quotas)
    sql

    # Callback applicatif pour synchronisation métier
    update control {
      REST-HTTP-Header += "X-FreeRadius-Section: accounting"
    }
    rest
  }

  session {
    sql
  }

  post-auth {
    sql

    if (&reply:Packet-Type == Access-Accept) {
      update control {
        REST-HTTP-Header += "X-FreeRadius-Section: post-auth"
      }
      rest
    }
  }
}
